!function (a) {
    "use strict";
    a(function () {
        var b = a(window),
            c = a(document.body),
            content = '',
            numero = '',
            operation = '',
            form = ''

            $(".guardarhorario").on("click", function (event) {
      
                event.preventDefault();
                var codigo = $('#codigo').val();
                var cod_curso = $('#cod_curso').val();
                var accion = $('#accion').val();
                var horario = $('#horario').val();
                var edades = $('#edades').val();
                var estado = $('#estado').val();

                if (horario == "") {
                   Swal.fire({
                       icon: 'warning',
                       title: '¡Advertencia!',
                       text: 'Debe imgresar el horario',
                   })
                } else {
                   if (edades == "") {
                       Swal.fire({
                           icon: 'warning',
                           title: '¡Advertencia!',
                           text: 'Debe ingresar lel rango de edades',
                       })
                   } else {
                       if (estado == "") {
                           Swal.fire({
                               icon: 'warning',
                               title: '¡Advertencia!',
                               text: 'Debe seleccionar un estado',
                           })
                       } else {
                            Swal.fire({
                                title: '¿Está seguro?',
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: '¡Sí, guardar!'
                            }).then((result) => {
                                if (result.value) {
                                    var resp = GuardarHorario();
                                    if (resp[0] == "success") {
                                        Swal.fire({
                                            icon: 'success',
                                            title: '¡Éxito!',
                                            text: resp[1],
                                        }).then((result) => {
                                            if (result.value) {
                                                $("#horario_form")[0].reset();
                                                $('#codigo').val('');
                                                ListaHorarios(cod_curso);
                                            }
                                        });
                                    } else {
                                        Swal.fire({
                                            icon: 'error',
                                            title: '¡Error!',
                                            text: resp[1],
                                        })
                                    }
                                }
                            })
                       }
                   }
                }
            });

            a("#AgregarHorarios").on("show.bs.modal", function (b) {
                var c = a(b.relatedTarget),
                    codigo = c.data("codigo"),
                    disciplina = c.data("disciplina"),
                    curso = c.data("curso"),
                    e = a(this);

                    document.getElementById("cod_curso").value = codigo;

                    e.find(".modal-title").text("HISTORIAL");
                    e.find(".modal-title").text("[" + disciplina + "]");

                    responsive: true;
                    $.fn.dataTable.moment('M/D/YYYY h:m:s A');
                    var dt = $('#DetalleHorarios').DataTable({
                        destroy: true,
                        "order": [],
                        "language": {
                            "lengthMenu": "Ver _MENU_ registros por página",
                            "zeroRecords": "No se encontraron resultados",
                            "info": "Viendo página _PAGE_ de _PAGES_",
                            "infoEmpty": "No se encontraron registros",
                            "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                            "search": "Buscar:",
                            "paginate": {
                                "first": "Primero",
                                "last": "Último",
                                "next": "Siguiente",
                                "previous": "Anterior"
                            },
                        },
                        "ajax": {
                            "type": "get",
                            "url": "../horarios/listar",
                            "data": { curso: codigo }
                        },
                        "columns": [
                            {"data": "horario"},
                            {"data": "edades"},
                            {"data": "estado",
                                render: function (data) {
                                    if (data == "1") {
                                        return "<span class='label label-success'>Activado</span>";
                                    } else if (data == "2") {
                                        return "<span class='label label-warning'>Desactivado</span>";
                                    } else {
                                        return "<span class='label label-danger'>Eliminado</span>";
                                    }
                                },
                            },
                            {
                                "data": "id_horario",
                                render: function (data) {
                                    return "<a class='btn btn-default'" +
                                            "style='cursor:pointer;overflow: visible;'" +
                                            "onclick='EditarHorario(" + data + ")'" +
                                            "data-toggle='modal'" +
                                            "data-content=''>" +
                                            "Editar</a>"
                                },
                            },
                        ]
                    });  
            })

    })}(jQuery), function () {
    "use strict";
    $('#fono').keyup(function () {
        this.value = (this.value + '').replace(/[^0-9]/g, '');
    });

}();

function EditarHorario(id_horario) {
    var codigo = codigo;
    return $.ajax({
       type: "get",
       url: '../horarios/editar',
       data: {
           codigo: id_horario
       },  
       success: function (data) {
           $.each(data, function (i, item) {
               $('#codigo').val(item.id_horario);
               $('#horario').val(item.horario);    
               $('#edades').val(item.edades);
               $('#estado_horario').val(item.estado);
           });
       },
       error: function () {
       }
    });
}
    
function GuardarHorario() {
    var formData = new FormData($("#horario_form")[0]);
    var resultado = "";
    $.ajax({
        url: "../horarios/registrar",
        async: false,
        type: 'POST',
        data: formData,
        contentType: false,
        enctype: 'multipart/form-data',
        processData: false,
        dataType: 'json',
        success: function (datos) {
            resultado = datos.response;
            mensaje = datos.message;
        }
    });
    return [resultado, mensaje];
}

function ListaHorarios(cod_curso) {
    responsive: true;
    $.fn.dataTable.moment('M/D/YYYY h:m:s A');
    var dt = $('#DetalleHorarios').DataTable({
        destroy: true,
        "order": [],
        "language": {
            "lengthMenu": "Ver _MENU_ registros por página",
            "zeroRecords": "No se encontraron resultados",
            "info": "Viendo página _PAGE_ de _PAGES_",
            "infoEmpty": "No se encontraron registros",
            "infoFiltered": "(filtrado de un total de _MAX_ registros)",
            "search": "Buscar:",
            "paginate": {
                "first": "Primero",
                "last": "Último",
                "next": "Siguiente",
                "previous": "Anterior"
            },
        },
        "ajax": {
            "type": "get",
            "url": "../horarios/listar",
            "data": { curso: cod_curso }
        },
        "columns": [
            {"data": "horario"},
            {"data": "edades"},
            {"data": "estado",
                render: function (data) {
                    if (data == "1") {
                        return "<span class='label label-info'>Activado</span>";
                    } else if (data == "2") {
                        return "<span class='label label-warning'>Desactivado</span>";
                    } else {
                        return "<span class='label label-danger'>Eliminado</span>";
                    }
                },
            },
            {
                "data": "id_horario",
                render: function (data) {
                    return "<a class='btn btn-default'" +
                            "style='cursor:pointer;overflow: visible;'" +
                            "onclick='EditarHorario(" + data + ")'" +
                            "data-toggle='modal'" +
                            "data-content=''>" +
                            "Editar</a>"
                },
            },
        ]
    }); 
}

function NuevoHorario() {
    $("#horario_form")[0].reset();
    $('#codigo').val('');
}






